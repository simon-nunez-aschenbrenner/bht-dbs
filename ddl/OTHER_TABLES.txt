CREATE SEQUENCE SEQUENCE
CREATE TABLE H5N1_BEGRIFF (BEGRIFF VARCHAR(20) PRIMARY KEY)
INSERT INTO H5N1_BEGRIFF (BEGRIFF) SELECT * FROM (SELECT H5N1_BEGRIFF_A.NAME||' '||H5N1_BEGRIFF_B.NAME FROM H5N1_BEGRIFF_A, H5N1_BEGRIFF_B) UNION (SELECT H5N1_BEGRIFF_B.NAME||' '||H5N1_BEGRIFF_A.NAME FROM H5N1_BEGRIFF_A, H5N1_BEGRIFF_B) UNION (SELECT H5N1_BEGRIFF_C.NAME FROM H5N1_BEGRIFF_C)
CREATE TABLE NUTZER_IN (ID INTEGER PRIMARY KEY)
INSERT INTO NUTZER_IN (ID) SELECT DISTINCT(ANONID) FROM AOLDATA.QUERYDATA
CREATE TABLE WEBSEITE (URL VARCHAR(200) PRIMARY KEY, KATEGORIE INTEGER REFERENCES WEBSEITE_KATEGORIE)
INSERT INTO WEBSEITE (URL, KATEGORIE) SELECT CLICKURL, KATEGORIE FROM (SELECT DISTINCT(CLICKURL) FROM AOLDATA.QUERYDATA JOIN H5N1_BEGRIFF ON QUERY LIKE '%'||BEGRIFF||'%' WHERE CLICKURL IS NOT NULL) LEFT JOIN WEBSEITE_PRE ON CLICKURL = URL
CREATE TABLE H5N1_SUCHE (ID INTEGER PRIMARY KEY, ZEITPUNKT TIMESTAMP(6), BEGRIFF VARCHAR(20) NOT NULL REFERENCES H5N1_BEGRIFF(BEGRIFF), NUTZER_IN INTEGER REFERENCES NUTZER_IN(ID), URL VARCHAR(200) REFERENCES WEBSEITE(URL), LAND VARCHAR(40) REFERENCES LAND(NAME))
INSERT INTO H5N1_SUCHE (ID, ZEITPUNKT, BEGRIFF, NUTZER_IN, URL, LAND) SELECT SEQUENCE.NEXTVAL, QUERYTIME, BEGRIFF, ANONID, CLICKURL, NAME FROM (AOLDATA.QUERYDATA JOIN H5N1_BEGRIFF ON QUERY LIKE '%'||BEGRIFF||'%') LEFT JOIN LAND ON QUERY LIKE '%'||NAME||'%'
CREATE TABLE FOLGESUCHE (ID INTEGER PRIMARY KEY, ZEITPUNKT TIMESTAMP(6), BEGRIFF VARCHAR(20) NOT NULL REFERENCES FOLGE_BEGRIFF(BEGRIFF), NUTZER_IN INTEGER REFERENCES NUTZER_IN(ID))
INSERT INTO FOLGESUCHE (ID, ZEITPUNKT, BEGRIFF, NUTZER_IN) SELECT SEQUENCE.NEXTVAL, QUERYTIME, BEGRIFF, ANONID FROM AOLDATA.QUERYDATA JOIN FOLGE_BEGRIFF ON QUERY LIKE '%'||BEGRIFF||'%' WHERE ANONID IN (SELECT NUTZER_IN FROM H5N1_SUCHE)
CREATE TABLE KRANKHEIT_SUCHE (ID INTEGER PRIMARY KEY, ZEITPUNKT TIMESTAMP(6), KRANKHEIT VARCHAR(50) NOT NULL REFERENCES KRANKHEIT(NAME), NUTZER_IN INTEGER REFERENCES NUTZER_IN(ID))
INSERT INTO KRANKHEIT_SUCHE (ID, ZEITPUNKT, KRANKHEIT, NUTZER_IN) SELECT SEQUENCE.NEXTVAL, QUERYTIME, NAME, ANONID FROM AOLDATA.QUERYDATA JOIN KRANKHEIT ON QUERY LIKE '%'||NAME||'%'